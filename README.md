# Проектная работа "Веб-ларек"
#### Интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 
---
Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура

Архитектура проекта разрабатывается с использованием паттерна MVP, в котором основными слоями являются: модели данных (M - model) - отвечают за работу с данными, компоненты представления (V - view) - отвечают за отображение данных на экране, презентер (P - presenter). Код презентера не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts.

## Типы данных

- Интерфейс IItem описывает объект с данными о товаре и соответствует типу данных, которые приходят с сервера через метод GET. Он содержит id товара, его описание, изображение, название, категорию и цену.
```
interface IItem {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number
}
```

- Интерфейс IOrder описывает объект с данными о заказе и соответствует типу объекта, который должен отправляться на сервер методом POST. Он содержит метод оплаты заказа, сумму заказа, массив id товаров, добавленных в заказ, и данные покупателя: адрес, телефон, почта.
```
interface IOrder {
    payment: string,
    email: string,
    phone: string,
    address: string,
    total: number,
    items: string[]
}
```

---

## Слой Model

### Класс ItemsDataModel 

Назначение: хранит данные о товарах, позволяет получить по id товара весь объект данных конкретного товара или некоторые его свойства: цена, категория.

Конструктор класса принимает экземпляр класса EventEmitter для работы с событиями.

Поле products содержит массив объектов типа IItem. Здесь хранятся данные о товарах.

Методы класса:

- Метод getItem принимает id типа string, находит в массиве products объект, у которого есть соответствующий id, и возвращает этот объект. Метод нужен для получения данных о конкретном товаре, по его id.

- Методы getPrice и getCategory принимают id типа string и, используя метод getItem, возвращают соответственно цену и категорию товара с данным id.

- Для свойства catalog написаны сеттер и геттер. Сеттер принимает массив объектов типа IItem, устанавливает этот массив в качестве значения поля products и создает событие 'items:changed'. Геттер возвращает массив объектов, хранящихся в поле products. Сеттер и геттер catalog нужны для заполнения массива данных о товарах и получения этого массива соответственно.

### Класс OrderModel 

Назначение: хранит данные о заказе.

Конструктор класса принимает экземпляр класса EventEmitter для работы с событиями.

Поле _order хранит объект типа IOrder. Здесь содержатся данные, необходимые для отправки заказа на сервер.

Методы класса:

- Методы addItem и removeItem меняют значения свойств объекта _order: items и total. Они принимают строку в качестве id товара и число в качестве цены товара.
Метод addItem нужен для добавления в заказ товара и прибавления к итоговой сумме его цены, а метод removeItem - для удаления из заказа товара и уменьшения итоговой суммы на цену этого товара.
Метод addItem добавляет в конец массива items полученный id и прибавляет к значению total переданную цену. 
Метод removeItem удаляет из массива items полученный id и отнимает от значения total переданную цену.
Оба метода создают событие 'order:changed'.

- Метод checkItem принимает строку в качестве id товара и возвращает true, если такой id есть в items, и false - если нет. Метод проверяет добавлен ли конкретный товар к заказу.

- Метод setOrder обновляет данные заказа переданными значениями. Метод принимает объект типа Partial<IOrder> и объединяет этот объект с объектом _order: переданный объект обновит своими значениями все такие же свойства в объекте _order. Метод создает событие 'order:changed'.

- Метод getTotal нужен для получения общей суммы заказа. Метод возвращает значение свойства total из объекта _order.

- Метод clearOrder нужен для очистки всех данных заказа. Метод обнуляет все значения свойств объекта _order.

- Для свойства order написан геттер. Он нужен для получения данных о заказе. Геттер возвращает объект _order.

---

## Базовые классы

### Класс Api

Назначение:
Выполняет HTTP-запросы к серверу: получение данных (GET) и отправку данных (POST, PUT, DELETE). Позволяет централизованно работать с API приложения.

Конструктор класса принимает:
- baseUrl — строку с базовым URL сервера, к которому будут выполняться все запросы.
- options — необязательный объект настроек запросов (формата RequestInit), например, для передачи дополнительных заголовков.
В конструкторе в настройки добавляется заголовок Content-Type: application/json, а также объединяются все переданные извне заголовки.

Поля класса:
- baseUrl — строка с базовым адресом сервера.
- options — объект настроек для каждого запроса (формата RequestInit).

Методы класса:

- Метод handleResponse принимает объект ответа сервера (Response). Если ответ успешный (свойство ok истинно), преобразует тело ответа в JSON и возвращает промис, который завершается полученным объектом. Если ответ содержит ошибку, преобразует тело в JSON и отклоняет промис со строкой ошибки (берётся значение из поля error в теле ответа или стандартный текст статуса). Нужен для централизованной обработки ответов и ошибок API.

- Метод get принимает путь к ресурсу — строку uri, которую нужно прибавить к базовому адресу. Выполняет GET-запрос и возвращает промис с результатом, обработанным через handleResponse. Используется для получения данных с сервера.

- Метод post принимает:
— строку uri с путём к ресурсу;
— объект data с отправляемыми данными;
— строку method с одним из значений: POST, PUT или DELETE (по умолчанию используется POST).
Выполняет запрос указанным методом, помещая данные в тело запроса в формате JSON. Возвращает промис с результатом, обработанным через handleResponse. Используется для отправки данных на сервер (например, для создания, обновления или удаления ресурсов).

### Класс EventEmitter

Назначение:
Реализует брокер событий, позволяя подписываться на события, инициировать их и управлять подписками. Используется для организации обмена данными между частями приложения без жёсткой связности.

Конструктор класса не принимает параметров. При создании экземпляра инициализируется пустой список событий _events в виде объекта Map, где ключами являются названия событий, а значениями — множества подписчиков.

Поле класса _events — коллекция типа Map, где ключи — названия событий (строки или регулярные выражения), а значения — множества функций-обработчиков.

Методы класса:

- Метод on принимает название события (строка или регулярное выражение) и функцию-обработчик. Добавляет обработчик в список подписчиков для данного события. Если такого события ещё нет, создаёт новую запись в списке _events. Используется для подписки на конкретное событие.

- Метод off принимает название события и функцию-обработчик. Удаляет обработчик из списка подписчиков для данного события. Если у события не остаётся обработчиков, событие удаляется из списка _events. Используется для отписки от конкретного события.

- Метод emit принимает название события и необязательные данные. Вызывает все обработчики, подписанные на это событие. Поддерживает:
— обработку событий по точному совпадению имени;
— обработку событий по регулярному выражению;
— глобальных обработчиков, подписанных на все события.

- Метод onAll принимает функцию-обработчик и подписывает её на все события, используя символ "*" как специальное имя события.

- Метод offAll не принимает параметров. Полностью очищает список всех подписчиков для всех событий.

- Метод trigger принимает название события и необязательный объект с контекстом. Возвращает функцию, которая при вызове будет инициировать переданное событие, объединяя данные, переданные при вызове, с контекстом. Удобен для создания готовых обработчиков, которые генерируют события при срабатывании.

### Класс Component

Назначение:
Предоставляет базовую функциональность для всех компонентов пользовательского интерфейса. Содержит методы для работы с DOM-элементами, которые могут использоваться и расширяться в дочерних классах.

Конструктор класса принимает DOM-элемент контейнера, в котором будет отображаться компонент. Параметр задаётся в виде объекта типа HTMLElement. Контейнер сохраняется в защищённом поле container и доступен в дочерних классах.

Поля класса container — DOM-элемент, в котором создаётся или отображается компонент. Доступен только для самого класса и его наследников.

Методы класса:

- Метод toggleClass принимает DOM-элемент, строку с именем класса и необязательный логический флаг. Переключает CSS-класс у переданного элемента. Если передан флаг, то класс добавляется или удаляется в зависимости от его значения.

- Метод setText принимает DOM-элемент и любое значение. Устанавливает текстовое содержимое элемента, преобразуя значение в строку.

- Метод setDisabled принимает DOM-элемент и логический флаг. Если флаг равен true, элемент блокируется (атрибут disabled устанавливается). Если false — элемент разблокируется (атрибут удаляется).

- Метод setHidden принимает DOM-элемент и скрывает его, устанавливая для стиля display значение none.

- Метод setVisible принимает DOM-элемент и делает его видимым, удаляя значение display из стилей.

- Метод setImage принимает элемент изображения, строку с адресом картинки и необязательный альтернативный текст. Устанавливает источник изображения и, если передан текст, добавляет его как значение атрибута alt.

- Метод render принимает необязательный объект с частичными данными для обновления состояния компонента. Обновляет текущий экземпляр переданными данными и возвращает корневой DOM-элемент компонента.

### Класс Validation

Назначение:
Отвечает за проверку данных формы заказа, хранение ошибок валидации и генерацию событий при изменении состояния формы. Позволяет определить пустые поля, формировать объект ошибок и сообщать другим частям приложения о готовности данных или наличии ошибок.

Конструктор класса принимает:
- errors — объект с текстами ошибок для каждого поля формы.
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе сохраняются тексты ошибок, инициализируются пустые массивы и объекты для хранения ошибок и данных формы.

Поля класса:
- formData — объект с текущими данными формы заказа (часть свойств типа IOrder).
- errorsTexts — объект, где ключи — имена всех полей формы, необходимых для заполнения, а значения — тексты ошибок для каждого поля.
- errorsKeys — массив с именами полей, которые не прошли валидацию.
- formErrors — объект, где ключ — имя поля формы, которое не прошло валидацию, а значение — текст ошибки для этого поля.

Методы класса:

- Сеттер formField принимает объект с частичными данными заказа и сохраняет его как текущие данные формы.

- Метод setOrderField принимает имя поля и его значение. Добавляет или обновляет значение в объекте данных формы. После изменения проверяет форму:
— если ошибок нет, вызывает событие 'order:ready' с данными формы;
— если ошибки были, очищает их.

- Метод clearErrors очищает массив имен пустых полей формы errorsKeys и объект текущих ошибок formErrors. Метод нужен для обновления валидации формы при каждом новом вводе данных.

- Метод clearValidation полностью очищает данные формы, подготавливая её для нового заполнения.

- Метод getEmptyProps принимает объект данных и возвращает массив ключей полей, значения которых отсутствуют или пустые. Метод нужен для поиска пустых полей формы.

- Метод setFormErrors принимает массив ключей с пустыми полями и объект текущих ошибок. Заполняет объект текущих ошибок парами «имя поля — текст ошибки» для всех пустых полей. 

- Метод validateForm определяет пустые поля в данных формы, формирует объект текущих ошибок, вызывает событие formErrors:change с обновлённым списком ошибок и возвращает true, если ошибок нет, и false, если они есть.

---

## Классы коммуникации

### Класс WebLarekApi

Назначение:
Расширяет базовый класс Api для работы с API приложения «WebLarek». Позволяет получать список товаров и отправлять данные заказа на сервер.

Конструктор класса принимает:
- cdn — строку с адресом CDN, используемого для подстановки полного пути к изображениям товаров.
- baseUrl — строку с базовым адресом сервера для всех API-запросов.
- options — необязательный объект с дополнительными настройками запросов (например, заголовки).
Конструктор вызывает конструктор родительского класса Api, передавая baseUrl и options, и сохраняет адрес CDN в поле cdn.

Поле класса cdn — строка с адресом CDN для формирования полного пути к изображениям товаров.

Методы класса:

- Метод getProductList не принимает параметров. Выполняет GET-запрос к ресурсу /product, получает список товаров и добавляет к каждому товару полный путь к изображению, объединяя адрес CDN с путём к файлу. Возвращает промис с массивом объектов товаров.

- Метод postOrder принимает объект с данными заказа. Выполняет POST-запрос к ресурсу /order, отправляя данные заказа на сервер. Возвращает промис с результатом обработки заказа от сервера.

---

## Слой View

### Класс Modal

Назначение:
Предоставляет функциональность модального окна: открытие, закрытие, управление содержимым и генерацию событий при изменении состояния окна. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент, который является корневым контейнером модального окна.
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе инициализируются кнопка закрытия и контейнер содержимого модалки. Настраиваются обработчики кликов:
— клик по кнопке или контейнеру закрывает модалку,
— клик по содержимому останавливает распространение события.

Поля класса:
- _closeButton — кнопка закрытия модального окна (HTMLButtonElement).
- _content — DOM-элемент для отображения содержимого модального окна (HTMLElement).

Методы класса:
- Сеттер content принимает DOM-элемент и заменяет содержимое модального окна на переданный элемент.

- Метод open не принимает параметров. Добавляет CSS-класс для отображения модалки и генерирует событие modal:open.

- Метод close не принимает параметров. Убирает CSS-класс отображения модалки, очищает содержимое и генерирует событие modal:close.

- Метод render принимает объект с данными для отображения (IModalData), обновляет внутреннее состояние через метод родителя render и открывает модальное окно. Возвращает корневой DOM-элемент контейнера.

### Класс Form

Назначение:
Реализует функциональность формы: отслеживание изменений полей, управление кнопкой отправки и отображение ошибок. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент формы (HTMLFormElement), в котором находятся поля и кнопка отправки.
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе инициализируются кнопка отправки и элемент для отображения ошибок формы. Настраиваются обработчики событий:
— при изменении любого поля формы (input) вызывается метод onInputChange, генерирующий событие изменения значения поля;
— при отправке формы (submit) предотвращается стандартное действие браузера и генерируется событие отправки формы с именем формы.

Поля класса:
- _submit — кнопка отправки формы (HTMLButtonElement).
- _errors — DOM-элемент для отображения ошибок формы (HTMLElement).

Методы класса:

- Метод onInputChange принимает имя поля и его значение. Генерирует событие input:change с информацией о поле и значении. Используется для отслеживания изменений полей формы.

- Сеттер valid принимает логическое значение. Включает или отключает кнопку отправки формы в зависимости от валидности (true — кнопка активна, false — кнопка заблокирована).

- Сеттер errors принимает строку с текстом ошибок и отображает её в элементе ошибок формы.

- Метод render принимает объект состояния формы, содержащий валидность, ошибки и значения полей. Обновляет состояние через метод родителя render и присваивает значения полей экземпляру класса. Возвращает корневой DOM-элемент формы.

### Класс Page

Назначение:
Предоставляет функциональность для работы со страницей приложения: отображение каталога товаров, состояния корзины и блокировки страницы. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент контейнера страницы.
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе инициализируются элементы разметки страницы и настраивается обработчик клика по корзине, который генерирует событие basket:open.

В полях класса будут сохранены следующие элементы разметки: счётчик корзины, контейнер каталога, обёртка страницы и элемент корзины.

Для следующих данных написаны сеттеры:
- counter — число, отображающее количество товаров в корзине.
- catalog — массив DOM-элементов товаров для отображения в каталоге.
- locked — логическое значение, которое блокирует или разблокирует взаимодействие с содержимым страницы.
Тип данных для объектов, передаваемых в рендер: IPage.

### Класс Card

Назначение:
Предоставляет функциональность для отображения карточки товара: заголовка, цены и кнопки действия. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент контейнера карточки.
- actions — необязательный объект с действиями для карточки, например, обработчик клика по кнопке.
В конструкторе инициализируются элементы разметки карточки и добавляется обработчик клика, если он передан.

 полях класса будут сохранены следующие элементы разметки: заголовок карточки, элемент для отображения цены и кнопка действия.

Для следующих данных написаны сеттеры:
- title — строка, отображающая название товара.
- price — число или null, отображающее цену товара; если цена отсутствует, выводится текст «Бесценно».
Тип данных для объектов, передаваемых в рендер: IItem.

### Класс CatalogItem

Назначение:
Расширяет класс Card для отображения элемента каталога с дополнительными свойствами: категория и изображение. Позволяет визуально различать тип товара и отображать картинку.

Конструктор класса принимает:
- container — DOM-элемент контейнера карточки каталога.
- category — строка с названием категории товара.
- actions — необязательный объект с действиями для карточки, например, обработчик клика.
В конструкторе инициализируются элементы разметки для категории и изображения, а также задаётся CSS-класс для категории в зависимости от её значения.

В полях класса будут сохранены следующие элементы разметки: элемент категории и элемент изображения.

Для следующих данных написаны сеттеры:
- category — строка, отображающая название категории товара.
- image — строка с адресом изображения товара.
Тип данных для объектов, передаваемых в рендер: IItem.

### Класс CardPreview

Назначение:
Расширяет класс CatalogItem для отображения превью карточки товара с описанием и динамическим текстом кнопки действия. Позволяет визуально показывать состояние товара в корзине.

Конструктор класса принимает:
- container — DOM-элемент контейнера карточки.
- categoryClassName — строка с названием CSS-класса категории товара.
- productState — логическое значение, определяющее состояние товара (в корзине или нет).
- actions — необязательный объект с действиями для карточки, например, обработчик клика.
В конструкторе инициализируется элемент для отображения описания товара и настраивается текст кнопки в зависимости от состояния товара.

В полях класса будут сохранены следующие элементы разметки: элемент для описания товара и кнопка действия (унаследована из Card).

Написан сеттеры для свойства description — строка, содержащая текст описания товара.
Тип данных для объектов, передаваемых в рендер: IItem.

### Класс Basket

Назначение:
Предоставляет функциональность для отображения корзины: список товаров, общую сумму и кнопку оформления заказа. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент контейнера корзины.
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе инициализируются элементы разметки корзины и настраивается обработчик клика по кнопке оформления заказа, который генерирует событие order:open. Также инициализируется пустой список элементов корзины.

В полях класса будут сохранены следующие элементы разметки: список товаров в корзине, элемент для отображения общей суммы и кнопка оформления заказа.

Для следующих данных написаны сеттеры:
- items — массив DOM-элементов товаров в корзине.
- total — число, отображающее общую сумму корзины.
- valid — логическое значение, которое блокирует или разблокирует кнопку оформления заказа.
Тип данных для объектов, передаваемых в рендер: IBasketView.

### Класс OrderForm

Назначение:
Расширяет класс Form для работы с формой оформления заказа: отслеживание выбора способа оплаты и заполнение адреса.

Конструктор класса принимает:
- container — DOM-элемент формы заказа (HTMLFormElement).
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе инициализируются элементы разметки формы для кнопок оплаты и настраивается обработчик клика по этим кнопкам, который генерирует событие payment:selected с выбранным способом оплаты.

В поле класса будет сохранен контейнер для кнопок выбора способа оплаты.

Для следующих данных написаны сеттеры:
- address — строка, используемая для заполнения поля адреса в форме.
Тип данных для объектов, передаваемых в рендер: Partial<IOrder>.

### Класс ContactsForm

Назначение:
Расширяет класс Form для работы с формой контактов: позволяет заполнять поля телефона и электронной почты.

Конструктор класса принимает:
- container — DOM-элемент формы контактов (HTMLFormElement).
- events — экземпляр класса EventEmitter для работы с событиями.
В конструкторе вызывается родительский конструктор для инициализации формы и настройки стандартных обработчиков.

В полях класса будут сохранены элементы разметки формы (унаследованы от Form).

Для следующих данных написаны сеттеры:
- phone — строка, используемая для заполнения поля телефона.
- email — строка, используемая для заполнения поля электронной почты.
Тип данных для объектов, передаваемых в рендер: Partial<IOrder>.

### Класс Success

Назначение:
Отображает экран успешного оформления заказа с суммой списанных средств и кнопкой закрытия. Наследуется от базового класса Component для работы с DOM.

Конструктор класса принимает:
- container — DOM-элемент контейнера экрана успеха.
- actions — объект с действиями для компонента, например, обработчик клика по кнопке закрытия.
В конструкторе инициализируются элементы разметки для кнопки закрытия и текстового контейнера с описанием, а также добавляется обработчик клика по кнопке, если он передан.

В полях класса будут сохранены следующие элементы разметки: кнопка закрытия и контейнер для текста с описанием.

Для следующих данных написаны сеттеры:
- total — число, отображающее сумму списанных синапсов.
Тип данных для объектов, передаваемых в рендер: ISuccess.

---

## Слой Presenter

Код презентера не выделяется в отдельный класс, а размещается в основном скрипте приложения index.ts.
При написании презентера используется событийно-ориентированный подход.
Презентер использует брокер событий EventEmitter для организации взаимодействия между слоями View и Model.

### События

Основные события, используемые в презентере:
- items:changed — данные каталога товаров изменились.
- card:select — пользователь выбрал товар для просмотра в модальном окне.
- basket:open — открытие корзины.
- order:changed — данные заказа изменились (добавлен или удален товар).
- order:open — открыть форму заказа (шаг 1).
- order:submit — нажата кнопка «далее» на форме заказа.
- formErrors:change — изменился статус валидации формы.
- payment:selected — пользователь выбрал способ оплаты.
- input:change — изменилось значение одного из полей формы.
- order:ready — форма заказа прошла валидацию.
- contacts:submit — нажата кнопка «оплатить» на форме контактов.
- modal:open / modal:close — открытие или закрытие модального окна.

### Пример взаимодействия: добавление товара в корзину.

1. Пользователь кликает по кнопке "купить"/"удалит из корзины" в окне товара (CardPreview).
- Вью реагирует на действие пользователя:
2. Генерирует событие card:select.
- Презентер обрабатывает событие и вызывает метод модели для изменения данных:
3. Обработчик events.on('card:select', ...) проверяет, есть ли товар уже в заказе через orderData.checkItem(item.id).
4. Если товара нет — вызывает orderData.addItem(item.id, item.price).
5. Если товар есть — вызывает orderData.removeItem(item.id, item.price).
- Модель изменяет данные и генерирует событие:
6. Методы addItem / removeItem внутри OrderModel обновляют объект заказа и вызывают событие order:changed.
- Презентер обрабатывает событие и вызывает рендер Вью, передавая данные из модели:
7. Обработчик events.on('order:changed', ...) обновляет счетчик корзины на странице (page.counter = cartCount).
8. Обновляет валидность корзины (basket.valid = !!cartCount).
9. Обновляет массив карточек товаров в корзине (basket.items = orderData.order.items.map(...)).
10. Пересчитывает итоговую сумму (basket.total = orderData.getTotal()).
- Вью перерисовывается, отображая обновленные данные:
11. Пользователь видит обновленное количество товаров в корзине, изменившиеся карточки товаров и актуальную сумму заказа.
